var margin={top:30,right:0,bottom:0,left:30},width=$("#heatmap").width()-margin.left-margin.right,height=430-margin.top-margin.bottom,gridSize=Math.floor(width/24),legendElementWidth=2*gridSize,buckets=9,days=["一","二","三","四","五","六","日"],times=["1","2","3","4","5","6","7","8","9","10","11","12"],datasets=["/week_data.tsv"],opacityRange=[.1,1],colorInterpolate=d3.interpolateRgb,color=d3.scale.linear().range(["#367F7E","#83FFE4"]).interpolate(colorInterpolate),opacity=d3.scale.linear().range(opacityRange),svg=d3.select("#heatmap").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),dayLabels=svg.selectAll(".dayLabel").data(days).enter().append("text").text(function(t){return t}).attr("x",0).attr("y",function(t,e){return e*gridSize}).style("text-anchor","end").attr("transform","translate(-6,"+gridSize/1.5+")").attr("class",function(t,e){return e>=0&&e<=4?"dayLabel mono axis axis-workweek":"dayLabel mono axis"}),timeLabels=svg.selectAll(".timeLabel").data(times).enter().append("text").text(function(t){return t+"時"}).attr("x",function(t,e){return e*gridSize}).attr("y",8*gridSize).style("text-anchor","middle").attr("transform","translate("+gridSize/2+", -6)").attr("class",function(t,e){return e>=7&&e<=16?"timeLabel mono axis axis-worktime":"timeLabel mono axis"}),heatmapChart=function(t){d3.tsv(t,function(t){return{day:+t.day,hour:+t.hour,value:+t.value}},function(t,e){var a=color.domain([0,d3.max(e,function(t){return t.value})]),r=opacity.domain([0,d3.max(e,function(t){return t.value})]),n=svg.selectAll(".hour").data(e,function(t){return t.day+":"+t.hour});n.append("title"),n.enter().append("rect").attr("x",function(t){return(t.hour-1)*gridSize+.1}).attr("y",function(t){return(t.day-1)*gridSize+.1}).attr("class","hour bordered").attr("width",gridSize).attr("height",gridSize).style("fill",color[0]),n.transition().duration(1e3).style("fill",function(t){return a(t.value)}).style("fill-opacity",function(t){return r(t.value)}),n.select("title").text(function(t){return t.value}),n.exit().remove()})};heatmapChart(datasets[0]);