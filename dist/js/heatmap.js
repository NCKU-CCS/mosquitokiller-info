var margin={top:30,right:0,bottom:0,left:30},width=$("#heatmap").width()-margin.left-margin.right,height=700-margin.top-margin.bottom,textSize=100;gridSize=Math.floor(height/25),legendElementWidth=2*gridSize,buckets=9,days=["一","二","三","四","五","六","日"],times=["01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"],datasets=["/week_data.tsv"],opacityRange=[.1,1],colorInterpolate=d3.interpolateRgb;var color=d3.scale.linear().range(["#367F7E","#83FFE4"]).interpolate(colorInterpolate),opacity=d3.scale.linear().range(opacityRange),svg=d3.select("#heatmap").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),dayLabels=svg.selectAll(".dayLabel").data(days).enter().append("text").text(function(t){return t}).attr("x",function(t,e){return e*textSize}).attr("y",0).style("text-anchor","end").attr("transform","translate("+textSize/1.5+", -6)").attr("class",function(t,e){return e>=0&&e<=4?"dayLabel mono axis axis-workweek":"dayLabel mono axis"}),timeLabels=svg.selectAll(".timeLabel").data(times).enter().append("text").text(function(t){return t}).attr("x",0).attr("y",function(t,e){return e*gridSize}).style("text-anchor","middle").attr("transform","translate(-10, "+gridSize/1.5+")").attr("class",function(t,e){return e>=7&&e<=16?"timeLabel mono axis axis-worktime":"timeLabel mono axis"}),heatmapChart=function(t){var e=color.domain([0,d3.max(t,function(t){return t.value})]),a=opacity.domain([0,d3.max(t,function(t){return t.value})]),r=svg.selectAll(".hour").data(t,function(t){return t.day+":"+t.hour});r.append("title"),r.enter().append("rect").attr("x",function(t){return(t.day-1)*textSize+12}).attr("y",function(t){return(t.hour-1)*gridSize+.1}).attr("class","hour bordered").attr("width",textSize).attr("height",gridSize).style("fill",color[0]),r.transition().duration(1e3).style("fill",function(t){return e(t.value)}).style("fill-opacity",function(t){return a(t.value)}),r.exit().remove()};